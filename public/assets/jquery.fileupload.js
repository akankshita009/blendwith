/*
 * jQuery File Upload Plugin 3.4
 *
 * Copyright 2010, Sebastian Tschan, AQUANTUM
 * Licensed under the MIT license:
 * http://creativecommons.org/licenses/MIT/
 *
 * https://blueimp.net
 * http://www.aquantum.de
 */
!function(t){var e,i;e=function(e){var i=this,n=e.is("form")?e:e.find("form").first(),s=n.find("input:file").first(),o={namespace:"file_upload",cssClass:"file_upload",dragDropSupport:!0,dropZone:e,url:n.attr("action"),method:n.attr("method"),fieldName:s.attr("name"),multipart:!0,multiFileRequest:!1,formData:function(){return n.serializeArray()},withCredentials:!1,forceIframeUpload:!1},a={},r={},l={},h="undefined",c="function",u="number",d=/^http(s)?:\/\//,p=function(t,e){var i=0;this.complete=function(){i+=1,i===e&&t()}},f=function(){return typeof XMLHttpRequest!==h&&typeof File!==h&&(!o.multipart||typeof FormData!==h||typeof FileReader!==h)},m=function(){o.dragDropSupport&&(typeof o.onDocumentDragEnter===c&&(a["dragenter."+o.namespace]=o.onDocumentDragEnter),typeof o.onDocumentDragLeave===c&&(a["dragleave."+o.namespace]=o.onDocumentDragLeave),a["dragover."+o.namespace]=i.onDocumentDragOver,a["drop."+o.namespace]=i.onDocumentDrop,t(document).bind(a),typeof o.onDragEnter===c&&(r["dragenter."+o.namespace]=o.onDragEnter),typeof o.onDragLeave===c&&(r["dragleave."+o.namespace]=o.onDragLeave),r["dragover."+o.namespace]=i.onDragOver,r["drop."+o.namespace]=i.onDrop,o.dropZone.bind(r)),l["change."+o.namespace]=i.onChange,s.bind(l)},g=function(){t.each(a,function(e,i){t(document).unbind(e,i)}),t.each(r,function(t,e){o.dropZone.unbind(t,e)}),t.each(l,function(t,e){s.unbind(t,e)})},v=function(t,e,i,n){typeof n.onProgress===c&&(i.upload.onprogress=function(s){n.onProgress(s,t,e,i,n)}),typeof n.onLoad===c&&(i.onload=function(s){n.onLoad(s,t,e,i,n)}),typeof n.onAbort===c&&(i.onabort=function(s){n.onAbort(s,t,e,i,n)}),typeof n.onError===c&&(i.onerror=function(s){n.onError(s,t,e,i,n)})},y=function(e){if(typeof e.formData===c)return e.formData();if(t.isArray(e.formData))return e.formData;if(e.formData){var i=[];return t.each(e.formData,function(t,e){i.push({name:t,value:e})}),i}return[]},b=function(e){if(d.test(e)){var i=location.host,n=location.protocol.length+2,s=e.indexOf(i,n),o=s+i.length;return s!==n&&s!==e.indexOf("@",n)+1||e.length!==o&&-1===t.inArray(e.charAt(o),["/","?","#"])?!1:!0}return!0},_=function(t,e,i){i&&e.setRequestHeader("X-File-Name",unescape(encodeURIComponent(t.name))),e.setRequestHeader("Content-Type",t.type),e.send(t)},w=function(e,i,n){var s,o=new FormData;for(t.each(y(n),function(t,e){o.append(e.name,e.value)}),s=0;s<e.length;s+=1)o.append(n.fieldName,e[s]);i.send(o)},x=function(t,e){var i=new FileReader;i.onload=function(i){t.content=i.target.result,e()},i.readAsBinaryString(t)},k=function(e,i,n){var s="--",a="\r\n",r="";return t.each(n,function(t,i){r+=s+e+a+'Content-Disposition: form-data; name="'+unescape(encodeURIComponent(i.name))+'"'+a+a+unescape(encodeURIComponent(i.value))+a}),t.each(i,function(t,i){r+=s+e+a+'Content-Disposition: form-data; name="'+unescape(encodeURIComponent(o.fieldName))+'"; filename="'+unescape(encodeURIComponent(i.name))+'"'+a+"Content-Type: "+i.type+a+a+i.content+a}),r+=s+e+s+a},C=function(t,e,i){var n,s,o="----MultiPartFormBoundary"+(new Date).getTime();for(e.setRequestHeader("Content-Type","multipart/form-data; boundary="+o),n=new p(function(){e.sendAsBinary(k(o,t,y(i)))},t.length),s=0;s<t.length;s+=1)x(t[s],n.complete)},D=function(e,i,n,s){var o,a=b(s.url);v(e,i,n,s),n.open(s.method,s.url,!0),a?n.setRequestHeader("X-Requested-With","XMLHttpRequest"):s.withCredentials&&(n.withCredentials=!0),s.multipart?(o=typeof i===u?[e[i]]:e,typeof FormData!==h?w(o,n,s):typeof FileReader!==h?C(o,n,s):t.error("Browser does neither support FormData nor FileReader interface")):_(e[i],n,a)},T=function(e,i,n){var s=new XMLHttpRequest,a=t.extend({},o);typeof o.initUpload===c?o.initUpload(e,i,n,s,a,function(){D(i,n,s,a)}):D(i,n,s,a)},S=function(t,e){var i;if(o.multiFileRequest)T(t,e);else for(i=0;i<e.length;i+=1)T(t,e,i)},P=function(e,i){var o=y(i);n.find(":input").not(":disabled").attr("disabled",!0).addClass(i.namespace+"_disabled"),t.each(o,function(e,n){t('<input type="hidden"/>').attr("name",n.name).val(n.value).addClass(i.namespace+"_form_data").insertBefore(s)}),e.insertAfter(s)},E=function(t,e){t.remove(),n.find("."+e.namespace+"_disabled").removeAttr("disabled").removeClass(e.namespace+"_disabled"),n.find("."+e.namespace+"_form_data").remove()},j=function(t,e,i){e.unbind("abort").bind("abort",function(n){e.readyState=0,e.unbind("load").attr("src","javascript".concat(":false;")),typeof i.onAbort===c&&i.onAbort(n,[{name:t.val(),type:null,size:null}],0,e,i)}).unbind("load").bind("load",function(n){e.readyState=4,typeof i.onLoad===c&&i.onLoad(n,[{name:t.val(),type:null,size:null}],0,e,i)}),n.attr("action",i.url).attr("target",e.attr("name")),P(t,i),e.readyState=2,n.get(0).submit(),E(t,i)},I=function(e,i){var s=t('<iframe src="javascript:false;" style="display:none" name="iframe_'+o.namespace+"_"+(new Date).getTime()+'"></iframe>'),a=t.extend({},o);s.readyState=0,s.abort=function(){s.trigger("abort")},s.bind("load",function(){s.unbind("load"),typeof o.initUpload===c?o.initUpload(e,[{name:i.val(),type:null,size:null}],0,s,a,function(){j(i,s,a)}):j(i,s,a)}).appendTo(n)},M=function(){var e=s.clone(!0);t("<form/>").append(e).get(0).reset(),s.replaceWith(e),s=e};this.onDocumentDragOver=function(t){return typeof o.onDocumentDragOver===c&&o.onDocumentDragOver(t)===!1?!1:(t.preventDefault(),void 0)},this.onDocumentDrop=function(t){return typeof o.onDocumentDrop===c&&o.onDocumentDrop(t)===!1?!1:(t.preventDefault(),void 0)},this.onDragOver=function(t){if(typeof o.onDragOver===c&&o.onDragOver(t)===!1)return!1;var e=t.originalEvent.dataTransfer;e&&(e.dropEffect=e.effectAllowed="copy"),t.preventDefault()},this.onDrop=function(t){if(typeof o.onDrop===c&&o.onDrop(t)===!1)return!1;var e=t.originalEvent.dataTransfer;e&&e.files&&f()&&S(t,e.files),t.preventDefault()},this.onChange=function(e){return typeof o.onChange===c&&o.onChange(e)===!1?!1:(!o.forceIframeUpload&&e.target.files&&f()?S(e,e.target.files):I(e,t(e.target)),M(),void 0)},this.init=function(n){return n&&t.extend(o,n),e.data(o.namespace)?(t.error('FileUpload with namespace "'+o.namespace+'" already assigned to this element'),void 0):(e.data(o.namespace,i).addClass(o.cssClass),o.dropZone.addClass(o.cssClass),m(),void 0)},this.destroy=function(){g(),e.removeData(o.namespace).removeClass(o.cssClass),o.dropZone.removeClass(o.cssClass)}},i={init:function(i){return this.each(function(){new e(t(this)).init(i)})},destroy:function(e){return this.each(function(){e=e?e:"file_upload";var i=t(this).data(e);i?i.destroy():t.error('No FileUpload with namespace "'+e+'" assigned to this element')})}},t.fn.fileUpload=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.fileUpload"),void 0):i.init.apply(this,arguments)}}(jQuery);