videojs.Youtube=videojs.MediaTechController.extend({init:function(t,e,i){if(videojs.MediaTechController.call(this,t,e,i),this.features.fullscreenResize=!0,this.player_=t,this.player_el_=document.getElementById(this.player_.id()),i=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,(i=t.options().src.match(i))&&11==i[2].length){if(this.videoId=i[2],!this.player_.options().ytcontrols){this.player_.poster("http://img.youtube.com/vi/"+this.videoId+"/0.jpg");var n=this;setTimeout(function(){n.player_.posterImage.el().style.backgroundSize="cover"},50)}}else this.videoId="";this.id_=this.player_.id()+"_youtube_api",this.el_=videojs.Component.prototype.createEl("iframe",{id:this.id_,className:"vjs-tech",scrolling:"no",marginWidth:0,marginHeight:0,frameBorder:0,webkitAllowFullScreen:"",mozallowfullscreen:"",allowFullScreen:""}),this.player_el_.insertBefore(this.el_,this.player_el_.firstChild),e={enablejsapi:1,iv_load_policy:3,playerapiid:this.id(),disablekb:1,wmode:"transparent",controls:this.player_.options().ytcontrols?1:0,showinfo:0,modestbranding:1,rel:0,autoplay:this.player_.options().autoplay?1:0,loop:this.player_.options().loop?1:0},i=/[?&]list=([^#\&\?]+)/,i=t.options().src.match(i),null!=i&&1<i.length&&(e.list=i[1]),"file:"!=window.location.protocol&&(e.origin=window.location.origin),this.el_.src="http://www.youtube.com/embed/"+this.videoId+"?"+videojs.Youtube.makeQueryString(e),this.player_.options().ytcontrols&&(n=this,setTimeout(function(){n.player_.bigPlayButton.hide()},50)),videojs.Youtube.apiReady?this.loadYoutube():(videojs.Youtube.loadingQueue.push(this),videojs.Youtube.apiLoading||(t=document.createElement("script"),t.src="http://www.youtube.com/iframe_api",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e),videojs.Youtube.apiLoading=!0))}}),videojs.Youtube.prototype.dispose=function(){this.ytplayer.destroy(),videojs.MediaTechController.prototype.dispose.call(this)},videojs.Youtube.prototype.play=function(){this.isReady_?this.ytplayer.playVideo():(this.playOnReady=!0,this.player_.options.ytcontrols||this.player_.bigPlayButton.show())},videojs.Youtube.prototype.pause=function(){this.ytplayer.pauseVideo()},videojs.Youtube.prototype.paused=function(){return this.lastState!==YT.PlayerState.PLAYING&&this.lastState!==YT.PlayerState.BUFFERING},videojs.Youtube.prototype.currentTime=function(){return this.ytplayer.getCurrentTime()},videojs.Youtube.prototype.setCurrentTime=function(t){this.ytplayer.seekTo(t,!0),this.player_.trigger("timeupdate")},videojs.Youtube.prototype.duration=function(){return this.ytplayer.getDuration()},videojs.Youtube.prototype.buffered=function(){var t=this.ytplayer.getVideoBytesLoaded(),e=this.ytplayer.getVideoBytesTotal();if(!t||!e)return 0;var i=this.ytplayer.getDuration(),t=t/e*i,e=this.ytplayer.getVideoStartBytes()/e*i;return videojs.createTimeRange(e,e+t)},videojs.Youtube.prototype.volume=function(){return isNaN(this.volumeVal)&&(this.volumeVal=this.ytplayer.getVolume()/100),this.volumeVal},videojs.Youtube.prototype.setVolume=function(t){t&&t!=this.volumeVal&&(this.ytplayer.setVolume(100*t),this.volumeVal=t,this.player_.trigger("volumechange"))},videojs.Youtube.prototype.muted=function(){return this.ytplayer.isMuted()},videojs.Youtube.prototype.setMuted=function(t){t?this.ytplayer.mute():this.ytplayer.unMute();var e=this;setTimeout(function(){e.player_.trigger("volumechange")},50)},videojs.Youtube.prototype.onReady=function(){if(this.isReady_=!0,this.player_.trigger("techready"),this.player_.posterImage.hide(),this.triggerReady(),this.player_.trigger("durationchange"),this.playOnReady&&(this.player_.bigPlayButton.hide(),this.ytplayer.playVideo()),this.player_.options().ytcontrols){var t=this.player_.options();t.controls=!1,this.player_.options(t)}},videojs.Youtube.prototype.onStateChange=function(t){if(t!=this.lastState){switch(t){case-1:this.player_.trigger("durationchange");break;case YT.PlayerState.ENDED:this.player_.trigger("ended"),this.player_.options().ytcontrols||this.player_.bigPlayButton.show();break;case YT.PlayerState.PLAYING:this.player_.trigger("timeupdate"),this.player_.trigger("durationchange"),this.player_.trigger("playing"),this.player_.trigger("play");break;case YT.PlayerState.PAUSED:this.player_.trigger("pause");break;case YT.PlayerState.BUFFERING:this.player_.trigger("timeupdate"),this.player_.trigger("waiting"),this.player_.loadingSpinner.hide()}this.lastState=t}},videojs.Youtube.prototype.onPlaybackQualityChange=function(t){switch(t){case"medium":this.player_.videoWidth=480,this.player_.videoHeight=360;break;case"large":this.player_.videoWidth=640,this.player_.videoHeight=480;break;case"hd720":this.player_.videoWidth=960,this.player_.videoHeight=720;break;case"hd1080":this.player_.videoWidth=1440,this.player_.videoHeight=1080;break;case"highres":this.player_.videoWidth=1920,this.player_.videoHeight=1080;break;case"small":this.player_.videoWidth=320,this.player_.videoHeight=240;break;default:this.player_.videoWidth=0,this.player_.videoHeight=0}this.player_.trigger("ratechange")},videojs.Youtube.prototype.onError=function(t){this.player_.error=t,this.player_.trigger("error")},videojs.Youtube.isSupported=function(){return!0},videojs.Youtube.canPlaySource=function(t){return"video/youtube"==t.type},videojs.Youtube.loadingQueue=[],videojs.Youtube.prototype.loadYoutube=function(){this.ytplayer=new YT.Player(this.id_,{events:{onReady:function(t){t.target.vjsTech.onReady()},onStateChange:function(t){t.target.vjsTech.onStateChange(t.data)},onPlaybackQualityChange:function(t){t.target.vjsTech.onPlaybackQualityChange(t.data)},onError:function(t){t.target.vjsTech.onError(t.data)}}}),this.ytplayer.vjsTech=this},videojs.Youtube.makeQueryString=function(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return i.join("&")},window.onYouTubeIframeAPIReady=function(){for(var t;t=videojs.Youtube.loadingQueue.shift();)t.loadYoutube();videojs.Youtube.loadingQueue=[],videojs.Youtube.apiReady=!0};